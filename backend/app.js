const http = require("http");
const url = require("url");
require('dotenv').config();
const { getCvesList, getCveDetails } = require("./cves_controller");

const server = http.createServer((req, res) => {
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.setHeader(
    "Access-Control-Allow-Methods",
    "OPTIONS, GET, POST, PUT, PATCH, DELETE"
  );
  res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");

  const parsedUrl = url.parse(req.url, true);

  if (parsedUrl.pathname === "/cves/list") {
        getCvesList(req, res,parsedUrl);
  } else if (parsedUrl.pathname === "/cves") {
        getCveDetails(req, res, parsedUrl);

  }  else {
    res.writeHead(404, { "Content-Type": "text/plain" });
    res.end("Not Found");
  }
});

server.listen(process.env.PORT, () => {
  console.log(`Server running at http://localhost:${process.env.PORT}/`);
});
